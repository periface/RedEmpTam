var Engine=function(n){function r(n,t,i){for(var r=0;r<n.length;r++)if(n[r][t]===i)return n[r];return undefined}function f(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function u(n){return n.substring(n.indexOf(".")+1)}n||(console.warn("Options r null loading defaults..."),n={useOverlay:!0,autoStart:!1,overlayObj:undefined,enableDebug:!1,onAllRequestsFinished:undefined,resolveByConvention:!1});var t=this,i="propertyServiceName";return this.propertyServices=[],this.definePropertyService=function(n,i){t.propertyServices.push({propertyServiceName:n,propertyServiceEndPoint:i})},this.listener=function(){function e(u){var o=u.split("."),f,e;for(n.enableDebug&&console.info("Resolving service by convention"),f=0;f<o.length;f++)if(e=r(t.propertyServices,i,o[f]),e!=undefined)return f>0?(console.warn("Warning: The service "+e.propertyServiceName+" was resolved in position "+f),undefined):e;return undefined}var f=[];$("[data-property]").each(function(){var a=$(this),o=$(this).data("property"),c=$(this).data("servicename"),v=$(this).data("printproperty"),y=$(this).data("replicate"),p=$(this).data("callback"),w=$(this).data("ignoreall"),b=$(this).data("params"),l=$(this).data("async"),h,s;l==undefined&&(l=!0);h={propertyRequest:o,propertyServiceName:c,printInProperty:v,replicate:y,element:a,callbackFunc:p,useFuncOnly:w,runAsync:l,requestProperties:b};n.resolveByConvention?(s=e(o),s==undefined?(n.enableDebug&&console.warn("Resolve by convention failed for property "+o+" trying to resolve the service by default"),s=r(t.propertyServices,i,c)):(n.enableDebug&&console.warn("Resolve by convention succeded for property "+o),h.propertyRequest=u(h.propertyRequest))):s=r(t.propertyServices,i,c);s==undefined?(console.warn("Service undefined for property "+o),n.enableDebug&&console.info("Trying to get the service by convention for property "+o),s=e(o),s==undefined?(console.warn("Second try : Service undefined for property "+o),console.info("Seems like you have the convention resolver inactive and you dont have a data-servicename defined for this property ("+o+"), skipping.....")):(console.info("The convention resolver fixed the problem, but please check the code or enable the convention resolver in the options object"),h.propertyRequest=u(h.propertyRequest),t.buildAjaxObj(s.propertyServiceEndPoint,h,f))):t.buildAjaxObj(s.propertyServiceEndPoint,h,f)});$.when.apply($,f).done(t.allDoneFunction)},n.autoStart&&t.listener(),this.buildAjaxObj=function(n,i,r){if(n!==""&&i.propertyRequest!==""){var u=t.resolveDataRequest(i.propertyRequest,i.requestProperties);r.push($.ajax({url:n,data:u,async:i.runAsync,success:function(n){i.callbackFunc?i.useFuncOnly?t.callFunction(i.callbackFunc,n,i.element):(t.bindData(i,u),t.callFunction(i.callbackFunc,n,i.element)):t.bindData(i,n)}}))}},this.callFunction=function(n,t,i){try{window[n](t,i)}catch(r){console.warn("Callback function has failed to execute or has some internal errors, please check it out --->");console.log("----------------------------------");console.log(r);console.log("----------------------------------");console.info("Dont try to eval the function in the lib source dude... pls -->");console.info("Lets continue....");return}},this.allDoneFunction=function(){n.onAllRequestsFinished?(n.onAllRequestsFinished(),n.useOverlay&&t.hideOverlay()):(n.useOverlay&&t.hideOverlay(),console.log("All requests done"))},this.hideOverlay=function(){n.overlayObj?document.getElementById(n.overlayObj).style.width="0%":console.warn("No overlay defined")},this.bindData=function(n,i){n.printInProperty?(n.element.attr(n.printInProperty,i),n.replicate?t.appendDataInDomElement(n,i):t.appendOnlyId(n)):t.appendDataInDomElement(n,i)},this.appendDataInDomElement=function(n,t){n.element.text(t);n.element.attr("id",n.propertyRequest)},this.appendOnlyId=function(n){n.element.attr("id",n.propertyRequest)},this.getValueFromDomElement=function(n){var t=document.getElementById(n).value;return t?t:undefined},this.getValue=function(n,u,f,e){var o=r(t.propertyServices,i,n);o==undefined?console.error("Service undefined"):t.getValueFromService(o,u,f,function(n){e(n)})},this.getValueFromService=function(n,i,r,u){var f=t.resolveDataRequest(i,r);$.ajax({url:n.propertyServiceEndPoint,data:f,success:function(n){u(n)}})},this.resolveDataRequest=function(t,i){var u={key:t},r;return i!=undefined?(r=f(u,i),n.enableDebug&&(console.info("The request object has been extended --->"),console.log(r)),r):u},{propertyServices:this.propertyServices,defineNewPropertyService:this.definePropertyService,getValueFromDom:this.getValueFromDomElement,startListener:this.listener,getValue:this.getValue}};